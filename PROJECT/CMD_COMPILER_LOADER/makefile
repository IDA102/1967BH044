#$ make clean
#$ make

################################################
##_______________КОМПИЛЯТОР___________________##
################################################
SRC = "C:/Milandr/CM-LYNX.2.01.02/toolchain/Inc/"
#Генерирование полной отладочной информации.
G = -g
#Степень оптимизации.
O = -O0
#Установка режима вывода объектного файла (после обработки ассемблером). 
C = -c
#Установка режима вывода ассемблерного файла.
S = -S
#Установка размера double в 64 бита. 
DS = --double-size-64
#Установка размера char в 32 бита. 
CS = --char-size-32
#Установка целевой платформы LYNX. 
LYNX = --target=lynx
#Форматирование сообщений об ошибках, каждое сообщение об ошибке появляется в одной строке. 
MESSAGE = -fmessage-length=0


################################################
##________________АССЕМБЛЕР___________________##
################################################

#Генерирование полной отладочной информации.
#G = -g
#Генерирует именованный файл листинга.
L = -l
#Указывает целевой процессор, для которого ассемблер должен подготовить соответствующий код.
PROC = -proc 1967VN044
#Создать зависимости и продолжить работу. 
M = -MM
#Опция -Mo filename имеет приоритет над опцией -o filename.
M0= -Mo
#Искать включаемые файлы по указанному пути. 
i = -i ..
#Указать путь для поиска системных включаемых файлов.
ii = -i-
#Искать включаемые системные файлы по указанному пути.
INCLUDE = -i "C:\Milandr\CM-LYNX.2.01.02\toolchain\Inc"
#Определить макрос. 
MACROS = -D __1967VN044__=1
MACROS2 = -D __llvm__
#Задает имя целевого выходного объектного файла. 
O_NAME = -o  "main.doj"
#Создать зависимости и продолжить работу. 

################################################
##________________КОМПОНОВЩИК_________________##
################################################

#Генерировать карту памяти всех символов в <file>. 
MAP = -Map "main.map"
#Создать файл перекрестных ссылок (xref) в выходном каталоге компоновщика. 
XREF = -xref "main.xref"
#Ввести имя компонуемого библиотечного файла. 
LIB = clib.dlb libcxx.dlb libcxxabi.dlb libunwind.dlb
#Найти библиотечные файлы по указанному пути. 
LIB_PATH = -L "C:\Milandr\CM-LYNX.2.01.02\toolchain\LibLLVM"
#Объявить и присвоить значение def макросу препроцессора с именем macro. 
MD = -MD __1967VN044__
#Создать зависимости и продолжить работу.Генерировать зависимости в файл. 
MMM0 = -MM -Mo link.deps
#Поместить выходные файлы в текущую папку. 
OD = -od .
#Ввести имя LDF-файла. 
NAME_LDF = -T default.ldf
#Искать включаемые файлы по указанному пути. 
i_ldf = -i "C:\Milandr\CM-LYNX.2.01.02\toolchain\Inc"
#Если опция задана, компоновщик для каждой входной секции проверяет реальную используемость символов этой секции. Если ни один из них не используется, данная входная секция исключается из процедуры формирования выходных секций и, соответственно, всего целевого образа .dxe. 
GC = --gc-sections
#Указать имя выходного исполняемого файла. 
NAME_DXE= -o  "main.dxe"

all: main.s main.doj main.dxe

main.s: main.c 
	clang.exe -I $(SRC) $(G) $(C) $(S) $(DS) $(CS) $(LYNX) $(MESSAGE) $(O) main.c
main.doj: main.s 
	mca-tsh.exe $(G) $(L) . $(PROC) $(M) $(M0) asm.deps $(i) $(ii) $(INCLUDE) $(MACROS) $(MACROS2) $(O_NAME) main.s
main.dxe: main.doj
	mclink-tsh.exe $(MAP) $(XREF) $(DS) $(CS) $(LIB) $(LIB_PATH) $(MD) $(MMM0) $(OD) $(NAME_LDF) $(i_LDF) $(GS) $(NAME_DXE) main.doj
